# 平台架构 #

OTT平台从功能架构上分成四个组成部分，分别是内容管理与发布系统、内容获取与处理系统、内容存储与分发系统以及多屏终端系统。如下图所示，说明了各系统之间的关系。

![](../images/i4tvsolution.png)

## 内容获取与处理

### 内容获取

针对各种不同来源的内容，有不同的获取手段，OTT系统平台能够获取各种不同来源的内容，包括如下内容来源：


 * 卫星电视内容的获取
 * 有线电视内容的获取
 * 地面电视内容的获取
 * 网络内容的获取
 * 离线内容的获取
 * 用户生成内容的获取

### 内容处理

内容处理流程包括，解码、重新编码。当前视频主要采用H.264编码，音频主要采用AAC编码，字幕采用DVB标准或者外挂字幕。

 * 实时内容的处理
 * 离线内容的处理
 * 用户生成内容的处理

采用纯软件编码，硬件采用通用的硬件平台，因为可以在保护投资的情况下升级到H.265等更高压缩效率的视频编码。

可以对内容进行各种规格的编码和各种格式的封装，从而实现对于多屏终端的支持。支持的编码类型包括H.264，VP8等，支持的封装格式包括MPEGTS、MP4、WebM、FLV等。

以下是通用的硬件平台 – DELL R620，在这个硬件平台上能并发进行16路标清H.264视频编码，该硬件平台的配置情况如下

    机架高度：      1RU
    工作温度：      0~50摄氏度
    功    耗：      750瓦
    C  P  U：      2颗英特尔® 至强® 处理器 E5-2620
    内    存：      32G
    网口配置：      4个千兆网口
    编码能力：      16路标清或者4路高清实时编码

## 内容存储与分发

### 内容存储

内容存储采用并行文件系统，与SAN或者NAS等传统的存储方式相比，网络文件系统具有明显的优势，包括扩展性，易用性、灵活性以及低成本等特点。

### 内容分发

内容分发基于成熟的HTTP协议以及媒体文件分片的机制，即能应用于Intranet也能应用于Internet。

内容分发平台的缓存机制遵循“长尾效应”(long tail)定律，越是热门的内容越是缓存到系统最边缘，即：最热门的视频片段缓存到推流服务器的内存，次热门的缓存到推流服务器的硬盘，整个系统的所有视频内容都存储在中心片库。

## 内容管理与发布

### 内容管理

OTT系统平台内容管理支持对直播内容、离线点播内容的管理，另外还支持对用户生成内容的管理。

OTT系统平台通过管理界面对直播内容进行管理，可以通过界面直接操作内容获取和处理，对直播内容的来源编码方式，封装方式等进行配置操作，还可以对于直播内容的时移和录制等进设置。

OTT系统平台通过管理界面对于离线内容进行管理，通过界面操作实现内容的上载和处理，并实现对于内容处理的各种参数的控制，内容的上载支持超过4G大小的文件进行上传，从而能够支持高清内容的处理。

支持自定义的内容分类。运营商可以根据自己的实际情况对内容进行适当的分类，并通过管理界面输入到系统中。

支持内容的评论，播放统计等功能。

与内容存储的集成易于实现，可以把内容存储在各种存储空间，甚至可以实现对视频网站内容的访问。

### 内容发布

内容管理与发布支持对于内容的审核。

内容的发布考虑到对多屏终端的支持，主要包括对PC浏览器的支持，对移动屏的支持，以及对电视屏的支持。

对PC客户端的支持，需要在浏览器中嵌入播放器，可以采用flash，也可以采用html5。

对移动的支持考虑到两种主流的操作系统，iOS和Android，针对这两种操作系统提供相应的应用。

对电视屏的支持通过提供能运行于主流的机顶盒上的应用来实现，目前主流的机顶盒都是跑的Android操作系统。

## 多屏终端

互联网时代初期，计算机屏幕把人们从点视频上吸引过去，随着移动互联网的发展，有用一部分人被吸引到了移动设备的屏幕上。OTT系统平台支持电视、电脑和移动屏等多屏终端。

### 移动终端

随着移动互联网的迅速发展，更多的人通过移动终端来访问视频内容。OTT系统平台的一个组成部分就是移动终端应用。移动终端应用包括Android操作系统以及iOS操作系统，通过下载安装响应的应用，用户可以采用包括苹果核Android系统在内的各种手机和移动设备对OTT平台进行访问。

### 电视终端

现在用于电视的终端设备已经非常普及了，比如小米盒子、Google Chromecast等等，OTT平台支持各种Android以及iOS系统的盒子。

### PC终端

PC终端采用浏览器加flash播放器或者浏览器加HTML5来实现。支持各种主流的浏览器，包括Firefox以及Chrome等。

## 运维管理与监控

运维监控系统从基础设施、业务和运营状态三个层面对整个OTT系统平台的运营状况进行监控。

### 基础设施监控

系统层面的监控主要针对操作系统的运行状况进行监控。对于系统层面的监控采用开源软件Nagios（Nagios Ain’t Goona Insist on Saintood）。

Nagios是一款免费的开源 IT 基础设施监控系统，其功能强大，灵活性强，能有效监控 Windows 、Linux、VMware 和 Unix 主机状态，交换机、路由器等网络设置等。一旦主机或服务状态出现异常时，会发出邮件或短信报警第一时间通知 IT 运营人员，在状态恢复后发出正常的邮件或短信通知。如下图所示是Nagios的原理图。

### 业务监控

业务监控包括对内容源的监控，服务提供状态的监控，具体包括内容获取和处理的监控，内容分发和存储的监控。

### 运营状况监控

系统运营状况的监控包括并发用户数的监控。

### 播放情况统计

